<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ramp Help Assistant â€” Chat Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="topbar">
  <div class="container">
    <div class="brand-wrap">
      <img src="ramplogo.png" alt="Ramp" class="logo">
      <h1 class="brand small">Ramp Help Assistant</h1>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="operator.html">Operator UX</a>
      <a href="human.html">Human UX</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="panel">
    <h2>Ask our Help Assistant</h2>
    <div class="chat-wrap">
      <div id="chatLog" class="chat-log">
        <div class="bot">ðŸ¤– Hi â€” ask me product help. Iâ€™ll retrieve snippets with metadata & confidence.</div>
      </div>

      <div class="chat-input">
        <input id="userQ" placeholder="Ask me anything about Ramp (e.g., 'How do I set a card limit for UK admins?')" style="flex:1;" />
        <select id="pretendRole">
          <option value="roleselection">Select Role:</option>
          <option value="admin">Admin</option>
          <option value="card">Cardholder</option>
          <option value="accountant">Accountant</option>
        </select>
        <select id="pretendTier">
          <option value="tierselection">Select Tier:</option>
          <option value="free">Free</option>
          <option value="plus">Plus</option>
        </select>
        <select id="pretendRegion">
          <option value="regionselection">Select Region:</option>
          <option value="us">US</option>
          <option value="uk">UK</option>
          <option value="intl">Other</option>
        </select>
        <button id="askBtn" class="cta">Ask</button>
      </div>
    </div>
  </section>

  <section class="panel small">
    <h3>Retrieval behavior (mock)</h3>
    <ul>
      <li><strong>Metadata-aware:</strong> Filters by role, tier, region before ranking.</li>
      <li><strong>Snippet-level:</strong> Return top paragraph(s) with links to source articles.</li>
      <li><strong>Confidence threshold:</strong> Low confidence triggers suggested-articles fallback and flags operator review.</li>
      <li><strong>Usage-aware ranking:</strong> View counts + helpfulness influence rank and confidence.</li>
    </ul>
  </section>
</main>

<footer class="footer">
  <div class="container"><small>Ramp Help Assistant demo â€” mock retrieval</small></div>
</footer>

<script>
// Expanded corpus
const corpus = [
  {id:1, title:"Bill payment methods and timelines", paragraph:"ACH payments typically clear in 1â€“2 business days in the US; Plus members have expedited rails.", metadata:{role:"admin", tier:"all", region:"us"}, views:14240},
  {id:2, title:"Managing Card Limits", paragraph:"Admins can set per-user card limits via Admin â†’ Cards â†’ Manage limit. UK admins can set limits in GBP.", metadata:{role:"admin", tier:"all", region:"uk"}, views:8420},
  {id:3, title:"Plus: Auto-approval policies", paragraph:"Plus customers can configure auto-approval thresholds for faster procurement.", metadata:{role:"admin", tier:"plus", region:"all"}, views:3200},
  {id:4, title:"Integrating with QuickBooks", paragraph:"Export receipts CSV then import to QuickBooks via Apps â†’ QuickBooks import.", metadata:{role:"accountant", tier:"all", region:"us"}, views:3000},
  {id:5, title:"Auto-capture receipts", paragraph:"Enable auto-capture by connecting your email and enabling forwarding. Works globally.", metadata:{role:"card", tier:"all", region:"all"}, views:12420},
  {id:6, title:"Booking travel on Ramp", paragraph:"Employees can book flights and hotels through Ramp Travel. Admins can set policies per region.", metadata:{role:"card", tier:"all", region:"intl"}, views:4100}
];

const chatLog=document.getElementById('chatLog');
function appendUser(text){const d=document.createElement('div');d.className='user';d.textContent=text;chatLog.appendChild(d);chatLog.scrollTop=chatLog.scrollHeight;}
function appendBot(html){const d=document.createElement('div');d.className='bot';d.innerHTML=html;chatLog.appendChild(d);chatLog.scrollTop=chatLog.scrollHeight;}

document.getElementById('askBtn').addEventListener('click',()=>{
  const query=document.getElementById('userQ').value.trim();
  const role=document.getElementById('pretendRole').value;
  const tier=document.getElementById('pretendTier').value;
  const region=document.getElementById('pretendRegion').value;
  if(!query) return;
  appendUser(query);
  appendBot('Searching relevant articles...');

  setTimeout(()=>{
    let candidates=corpus.filter(c=>{
      if(role && role!=='all' && c.metadata.role!==role && c.metadata.role!=='all') return false;
      if(tier && tier!=='all' && c.metadata.tier!==tier && c.metadata.tier!=='all') return false;
      if(region && region!=='all' && c.metadata.region!==region && c.metadata.region!=='all') return false;
      return true;
    });

    if(candidates.length===0) candidates=corpus.slice();

    // rank: simple keyword match boosts
    const q=query.toLowerCase();
    candidates.forEach(c=>{c.score=(c.views/200)+(q.includes(c.title.toLowerCase().split(" ")[0])?20:0);});
    candidates.sort((a,b)=>b.score-a.score);

    const top=candidates[0];
    const confidence=Math.min(98,40+Math.floor(top.views/200));

    if(confidence<55){
      chatLog.lastChild.innerHTML='<em>Low confidence â€” returning suggested articles and flagging for operator review.</em>';
      appendBot('<strong>Suggested articles</strong><br><ul><li><a href="article.html">Bill payment methods and timelines</a></li><li><a href="article.html">Auto-capture receipts</a></li></ul><div class="flag-note">Query flagged for operator review (mock)</div>');
      return;
    }

    chatLog.lastChild.remove();
    appendBot(`<div class="snippet">
      <div class="snippet-text">${top.paragraph}</div>
      <div class="snippet-meta">
        <span class="meta-pill"><strong>Source:</strong> ${top.title}</span>
        <span class="meta-pill"><strong>Role:</strong> ${top.metadata.role}</span>
        <span class="meta-pill"><strong>Tier:</strong> ${top.metadata.tier}</span>
        <span class="meta-pill"><strong>Region:</strong> ${top.metadata.region}</span>
        <span class="meta-pill confidence"><strong>Confidence:</strong> ${confidence}%</span>
      </div>
      <div class="snippet-actions">
        <button class="small" onclick="alert('Flagged for operator review (mock)')">Flag</button>
        <button class="small" onclick="alert('Open article in Help Center (mock)')">Open Article</button>
      </div>
    </div>`);
  },800);
});
</script>
</body>
</html>
